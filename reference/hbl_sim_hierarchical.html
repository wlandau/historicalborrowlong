<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Non-longitudinal hierarchical simulations. — hbl_sim_hierarchical • historicalborrowlong</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Non-longitudinal hierarchical simulations. — hbl_sim_hierarchical"><meta property="og:description" content="Simulate from the non-longitudinal hierarchical model."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">historicalborrowlong</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/methods.html">Methods</a>
    </li>
    <li>
      <a href="../articles/usage.html">Usage</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/wlandau/historicalborrowlong/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Non-longitudinal hierarchical simulations.</h1>
    <small class="dont-index">Source: <a href="https://github.com/wlandau/historicalborrowlong/blob/HEAD/R/hbl_sim_hierarchical.R" class="external-link"><code>R/hbl_sim_hierarchical.R</code></a></small>
    <div class="hidden name"><code>hbl_sim_hierarchical.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simulate from the non-longitudinal hierarchical model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hbl_sim_hierarchical</span><span class="op">(</span></span>
<span>  n_study <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  n_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  n_patient <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_rep <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  n_continuous <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  n_binary <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  constraint <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  s_delta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  s_beta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  s_sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  s_lambda <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  s_mu <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  s_tau <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  covariance_current <span class="op">=</span> <span class="st">"unstructured"</span>,</span>
<span>  covariance_historical <span class="op">=</span> <span class="st">"unstructured"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_study</span> <span class="op">*</span> <span class="va">n_rep</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mu</span>, times <span class="op">=</span> <span class="va">n_study</span><span class="op">)</span>, sd <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">tau</span>, times <span class="op">=</span> <span class="va">n_study</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  delta <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="op">(</span><span class="va">n_group</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_rep</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">constraint</span><span class="op">)</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd</span>
<span>    <span class="op">=</span> <span class="va">s_delta</span><span class="op">)</span>,</span>
<span>  beta <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_study</span> <span class="op">*</span> <span class="op">(</span><span class="va">n_continuous</span> <span class="op">+</span> <span class="va">n_binary</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">s_delta</span><span class="op">)</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_study</span> <span class="op">*</span> <span class="va">n_rep</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="va">s_sigma</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_rep</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">s_mu</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_rep</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="va">s_tau</span><span class="op">)</span>,</span>
<span>  rho_current <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  rho_historical <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_study</span> <span class="op">-</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>n_study</dt>
<dd><p>Number of studies to simulate.</p></dd>


<dt>n_group</dt>
<dd><p>Number of groups (e.g. study arms) to simulate per study.</p></dd>


<dt>n_patient</dt>
<dd><p>Number of patients to simulate per study per group.</p></dd>


<dt>n_rep</dt>
<dd><p>Number of repeated measures (time points) per patient.</p></dd>


<dt>n_continuous</dt>
<dd><p>Number of continuous covariates to simulate
(all from independent standard normal distributions).</p></dd>


<dt>n_binary</dt>
<dd><p>Number of binary covariates to simulate
(all from independent Bernoulli distributions with p = 0.5).</p></dd>


<dt>constraint</dt>
<dd><p>Logical of length 1, whether to pool all study arms
at baseline (first rep). Appropriate when the response is the raw
response (as opposed to change from baseline) and the first rep
(i.e. time point) is prior to treatment.</p></dd>


<dt>s_delta</dt>
<dd><p>Numeric of length 1, prior standard deviation
of the study-by-group effect parameters <code>delta</code>.</p></dd>


<dt>s_beta</dt>
<dd><p>Numeric of length 1, prior standard deviation
of the fixed effects <code>beta</code>.</p></dd>


<dt>s_sigma</dt>
<dd><p>Numeric of length 1, prior upper bound
of the residual standard deviations.</p></dd>


<dt>s_lambda</dt>
<dd><p>shape parameter of the LKJ priors
on the unstructured correlation matrices.</p></dd>


<dt>s_mu</dt>
<dd><p>Numeric of length 1,
prior standard deviation of <code>mu</code>.</p></dd>


<dt>s_tau</dt>
<dd><p>Numeric of length 1,
Upper bound on <code>tau</code>.</p></dd>


<dt>covariance_current</dt>
<dd><p>Character of length 1,
covariance structure of the current study.
Possible values are <code>"unstructured"</code> for fully parameterized
covariance matrices, <code>"ar1"</code> for AR(1) covariance matrices,
and <code>"diagonal"</code> for residuals independent across time within
each patient. In MCMC (e.g. <code><a href="hbl_mcmc_hierarchical.html">hbl_mcmc_hierarchical()</a></code>),
the covariance structure affects computational speed.
Unstructured covariance is slower than AR(1), and AR(1) is slower
than diagonal. This is particularly true for <code>covariance_historical</code>
if there are many historical studies in the data.</p></dd>


<dt>covariance_historical</dt>
<dd><p>Same as <code>covariance_current</code>,
but for the covariance structure of each separate historical study.
Each historical study has its own separate covariance matrix.</p></dd>


<dt>alpha</dt>
<dd><p>Numeric vector of length <code>n_rep</code> for the pooled
and model and length <code>n_study * n_rep</code> for the
independent and hierarchical models.
<code>alpha</code> is the vector of control group mean parameters.
<code>alpha</code> enters the model by multiplying with
<code>$matrices$x_alpha</code> (see the return value).
The control group in the data is the one with the
<code>group</code> column equal to 1.</p></dd>


<dt>delta</dt>
<dd><p>Numeric vector of length
<code>(n_group - 1) * (n_rep - as.integer(constraint))</code>
of treatment effect parameters.
<code>delta</code> enters the model by multiplying with
<code>$matrices$x_delta</code> (see the return value).
The control (non-treatment) group in the data is the one with the
<code>group</code> column equal to 1.</p></dd>


<dt>beta</dt>
<dd><p>Numeric vector of <code>n_study * (n_continuous + n_binary)</code>
fixed effect parameters. Within each study,
the first <code>n_continuous</code> betas
are for the continuous covariates, and the rest are for
the binary covariates. All the <code>beta</code>s for one study
appear before all the <code>beta</code>s for the next study,
and studies are arranged in increasing order of
the sorted unique values in <code>$data$study</code> in the output.
<code>betas</code> enters the model by multiplying with
<code>$matrices$x_alpha</code> (see the return value).</p></dd>


<dt>sigma</dt>
<dd><p>Numeric vector of <code>n_study * n_rep</code>
residual standard deviation parameters for each study
and rep. The elements are sorted with all the standard deviations
of study 1 first (all the reps), then all the reps of study 2, etc.</p></dd>


<dt>mu</dt>
<dd><p>Numeric of length <code>n_rep</code>,
mean of the control group means <code>alpha</code> for each rep.</p></dd>


<dt>tau</dt>
<dd><p>Numeric of length <code>n_rep</code>,
standard deviation of the control group means <code>alpha</code> for each rep.</p></dd>


<dt>rho_current</dt>
<dd><p>Numeric of length 1 between -1 and 1,
AR(1) residual correlation parameter for the current study.</p></dd>


<dt>rho_historical</dt>
<dd><p>Numeric of length <code>n_study - 1</code> between -1 and 1,
AR(1) residual correlation parameters for the historical studies.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list with the following elements:</p><ul><li><p><code>data</code>: tidy long-form dataset with the patient-level data.
one row per patient per rep and indicator columns for the study,
group (e.g. treatment arm), patient ID, and rep. The <code>response</code>
columns is the patient response. The other columns are
baseline covariates. The control group is the one with
the <code>group</code> column equal to 1, and the current study (non-historical)
is the one with the maximum value of the <code>study</code> column.
Only the current study has any non-control-group patients,
the historical studies have only the control group.</p></li>
<li><p><code>parameters</code>: named list of model parameter values.
See the model specification vignette for details.</p></li>
<li><p><code>matrices</code>: A named list of model matrices.
See the model specification vignette for details.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other simulate: 
<code><a href="hbl_sim_independent.html">hbl_sim_independent</a>()</code>,
<code><a href="hbl_sim_pool.html">hbl_sim_pool</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">hbl_sim_hierarchical</span><span class="op">(</span>n_continuous <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2,800 × 10</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    study group patient   rep covariate_study1_continuous1 covariate_study2_con…¹</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1     1       1     1                        0.342                      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     1     1       1     2                        0.342                      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     1     1       1     3                        0.342                      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     1     1       1     4                        0.342                      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     1     1       2     1                        1.01                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     1     1       2     2                        1.01                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     1     1       2     3                        1.01                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     1     1       2     4                        1.01                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     1     1       3     1                       -<span style="color: #BB0000;">0.948</span>                      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>     1     1       3     2                       -<span style="color: #BB0000;">0.948</span>                      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2,790 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ abbreviated name: ¹​covariate_study2_continuous1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 4 more variables: covariate_study3_continuous1 &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   covariate_study4_continuous1 &lt;dbl&gt;, covariate_study5_continuous1 &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   response &lt;dbl&gt;</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

