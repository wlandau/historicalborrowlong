<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods • historicalborrowlong</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methods">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">historicalborrowlong</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/methods.html">Methods</a>
    </li>
    <li>
      <a href="../articles/usage.html">Usage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wlandau/historicalborrowlong/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wlandau/historicalborrowlong/blob/main/vignettes/methods.Rmd" class="external-link"><code>vignettes/methods.Rmd</code></a></small>
      <div class="hidden name"><code>methods.Rmd</code></div>

    </div>

    
    
<p>This vignette defines the models and historical borrowing metrics
supported in the <code>historicalborrowlong</code> package.</p>
<div class="section level2">
<h2 id="models">Models<a class="anchor" aria-label="anchor" href="#models"></a>
</h2>
<div class="section level3">
<h3 id="definitions">Definitions<a class="anchor" aria-label="anchor" href="#definitions"></a>
</h3>
<p>Unless otherwise specified, Greek letters refer to parameters
estimated by the model, and Roman letters refer to fixed hyperparameters
and other constants set by the user in advance.</p>
<ul>
<li>“Study”: a clinical trial. Could be a borrowed clinical trial from
the past or a current clinical trial under analysis.</li>
<li>“Group”: a study arm, such as a treatment group or placebo
group.</li>
<li>“Rep”: a repeated measure in the context of repeated measures /
longitudinal modeling. Could be a time point such as a study visit.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>:
study index.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>:
index of the current study.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>k</mi></msub><annotation encoding="application/x-tex">y_k</annotation></semantics></math>:
vector of patient-by-rep clinical responses to a continuous outcome
variable for study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">(X)_{k}</annotation></semantics></math>:
the row of matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
corresponding to study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>:
Vector of control group mean parameters, one for each rep for the pooled
model, one for each study and rep in the hierarchical and independent
models. The first elements are for the historical studies, and the last
one is for the current study.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>:
Vector of study-specific treatment mean parameters. There is one for
each combination of study, non-control treatment group, and rep. An
optional constraint may be added to pool all arms at baseline within
each study, which reduces the number of elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>:
integer index for the elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>:
integer index for the elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>:
index of a rep (e.g. time point of a repeated measure such as a patient
visit in a clinical trial.)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>:
Vector of study-specific baseline covariate parameters.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>α</mi></msub><annotation encoding="application/x-tex">X_\alpha</annotation></semantics></math>:
model matrix for the control group mean parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
It has indicator columns to select the appropriate element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
for each element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>k</mi></msub><annotation encoding="application/x-tex">y_k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>δ</mi></msub><annotation encoding="application/x-tex">X_\delta</annotation></semantics></math>:
model matrix for the treatment mean parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>.
It has indicator columns to select the appropriate element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
for each element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>k</mi></msub><annotation encoding="application/x-tex">y_k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>β</mi></msub><annotation encoding="application/x-tex">X_\beta</annotation></semantics></math>:
model matrix for the baseline covariate fixed effect parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
It has indicator columns to select the appropriate element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
for each element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>k</mi></msub><annotation encoding="application/x-tex">y_k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math>:
Vector of rep-specific residual standard deviations for study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Λ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\Lambda_k</annotation></semantics></math>:
lower-triangular Cholesky factor of the by-rep residual correlation
matrix for study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>k</mi></msub><annotation encoding="application/x-tex">N_k</annotation></semantics></math>:
number of patients in study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\Sigma_k</annotation></semantics></math>:
by-rep residual covariance matrix of study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>:
number of repeated measures per subject.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>I</mi><mi>T</mi></msub><annotation encoding="application/x-tex">I_T</annotation></semantics></math>:
identity matrix with rows and columns equal to the number of repeated
measures per subject.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I(\cdot)</annotation></semantics></math>:
indicator function</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>,</mo><mi>ρ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">AR(1)(n, \rho)</annotation></semantics></math>:
an AR(1) correlation matrix with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows and correlation parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mi>k</mi></msub><annotation encoding="application/x-tex">m_k</annotation></semantics></math>
index to indicate the type of residual covariance of study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>:
1 for unstructured / fully parameterized, 2 for AR(1), and 3 for
diagonal.</li>
</ul>
</div>
<div class="section level3">
<h3 id="baseline-covariates">Baseline covariates<a class="anchor" aria-label="anchor" href="#baseline-covariates"></a>
</h3>
<p>The baseline covariates model matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>β</mi></msub><annotation encoding="application/x-tex">X_\beta</annotation></semantics></math>
adjusts for baseline covariates. It may contain a continuous column for
baseline and binary indicator columns for the levels of user-defined
covariates. All these columns are included if possible, but the method
automatically drops baseline covariate columns to ensure that the
combine model matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>X</mi><mi>k</mi><mo>*</mo></msubsup><mo>=</mo><msub><mrow><mo stretchy="true" form="prefix">[</mo><msup><msub><mi>X</mi><mi>α</mi></msub><mo>*</mo></msup><mspace width="1.0em"></mspace><msup><msub><mi>X</mi><mi>δ</mi></msub><mo>*</mo></msup><mspace width="1.0em"></mspace><msup><msub><mi>X</mi><mi>β</mi></msub><mo>*</mo></msup><mo stretchy="true" form="postfix">]</mo></mrow><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">X_k^* = \left [ {X_\alpha}^* \quad {X_\delta}^* \quad {X_\beta}^* \right ]_k</annotation></semantics></math>
is full rank, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>X</mi><mi>k</mi><mo>*</mo></msubsup><annotation encoding="application/x-tex">X_k^*</annotation></semantics></math>
denotes the rows of matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
corresponding to study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>,
with additional rows dropped if the corresponding elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
are missing. The choice of columns to drop from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><msub><mi>X</mi><mi>β</mi></msub><mi>k</mi><mo>*</mo></msubsup><annotation encoding="application/x-tex">{X_\beta}_k^*</annotation></semantics></math>
is determined by the rank and pivoting strategy of the QR decomposition
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>k</mi></msub><annotation encoding="application/x-tex">X_k</annotation></semantics></math>
using the Householder algorithm with pivoting (<code><a href="https://rdrr.io/r/base/qr.html" class="external-link">base::qr()</a></code>,
LINPACK routine DQRDC).</p>
<p>Separately within each study, each column of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>β</mi></msub><annotation encoding="application/x-tex">X_\beta</annotation></semantics></math>
is centered to have mean 0, and if possible, scaled to have variance 1.
Scaling ensures that the priors on parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
remain relatively diffuse relative to the input data. Study-level
centering ensures that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
parameters truly act as <em>unconditional</em> study-specific control
group means (as opposed to conditional on the subset of patients at the
reference level of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>β</mi></msub><annotation encoding="application/x-tex">X_\beta</annotation></semantics></math>),
and it ensures that borrowing across
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
components fully presents as control group borrowing.</p>
</div>
<div class="section level3">
<h3 id="model-matrices">Model matrices<a class="anchor" aria-label="anchor" href="#model-matrices"></a>
</h3>
<p>Each primary model is parameterized thus:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>α</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mi>α</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mi>δ</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mi>β</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
E(y) = \left( X_\alpha \right)_k \alpha + \left ( X_\delta \right)_k \delta + \left ( X_\beta  \right)_k \beta
\end{aligned}
</annotation></semantics></math></p>
<p>Above,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>α</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\alpha \right)_k</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\delta \right)_k</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\beta \right)_k</annotation></semantics></math>
are fixed matrices for study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\beta \right)_k</annotation></semantics></math>
is a conventional model matrix for the baseline covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>,
and the details are explained in the “Baseline covariates” section
below.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>α</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\alpha \right)_k</annotation></semantics></math>
is a matrix of zeroes and ones. It is constructed such that each scalar
component of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is the mean response of the control group in a particular study at a
given time point. Likewise,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\delta \right)_k</annotation></semantics></math>
is a matrix of zeroes and ones such that each scalar component of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
is the mean response of a non-control treatment group in a particular
study at a given time point.</p>
<p>To illustrate, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">y_{ijkt}</annotation></semantics></math>
be patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in treatment group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
(where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">j = 1</annotation></semantics></math>
is the control group) of study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
at time point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
and let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\left ( X_\beta \beta \right )_{ijkt}</annotation></semantics></math>
be the corresponding scalar element of the vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\left ( X_\beta \right ) \beta</annotation></semantics></math>.
Then,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>α</mi><mrow><mi>k</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>&gt;</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>δ</mi><mrow><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
E(y_{ijkt}) = I (j = 1) \alpha_{kt} + I (j &gt; 1) \delta_{jkt} + \left ( X_\beta \beta \right )_{ijkt}
\end{aligned}
</annotation></semantics></math></p>
<p>In addition, if the constraint in the parameterization is activated
(i.e. <code>hbl_mcmc_hierarchical(constraint = TRUE)</code>) then the
control and treatment patients are pooled at time point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t = 1</annotation></semantics></math>
within each study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mn>1</mn></mrow></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
E(y_{ijk1}) = \alpha_{k1} + \left ( X_\beta \beta \right )_{ijk1}
\end{aligned}
</annotation></semantics></math></p>
<p>This parameterization is represented in the more compact expression
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>α</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mi>α</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mi>δ</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mi>β</mi></mrow><annotation encoding="application/x-tex">\left( X_\alpha \right)_k \alpha + \left ( X_\delta \right)_k \delta + \left ( X_\beta  \right)_k \beta</annotation></semantics></math>
in the model definitions in this vignette.</p>
</div>
<div class="section level3">
<h3 id="post-processing">Post-processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h3>
<p>The <code><a href="../reference/hbl_summary.html">hbl_summary()</a></code> function post-processes the results
from the model. It accepts MCMC samples of parameters and returns
estimated marginal means of the response and treatment effect. To
estimate marginal means of the response, <code><a href="../reference/hbl_summary.html">hbl_summary()</a></code>
takes group-level averages of posterior samples of fitted values while
dropping covariate adjustment terms from the model
(i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>α</mi></msub><mi>α</mi><mo>+</mo><msub><mi>X</mi><mi>δ</mi></msub><mi>δ</mi></mrow><annotation encoding="application/x-tex">X_\alpha \alpha + X_\delta \delta</annotation></semantics></math>).
Because the columns of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>β</mi></msub><annotation encoding="application/x-tex">X_\beta</annotation></semantics></math>
are centered at their means, this choice is mathematically equivalent to
<code>emmeans::emmeans()</code> with the
<code>weights = "proportional"</code> (<span class="citation">Lenth
(2016)</span>).</p>
</div>
<div class="section level3">
<h3 id="hierarchical-model">Hierarchical model<a class="anchor" aria-label="anchor" href="#hierarchical-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hbl_sim_hierarchical.html">hbl_sim_hierarchical()</a></code></li>
<li><code><a href="../reference/hbl_mcmc_hierarchical.html">hbl_mcmc_hierarchical()</a></code></li>
</ul>
<p>The hierarchical model analyzes the data from all studies and shrinks
the control study-by-rep means
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mrow><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\alpha_{kt}</annotation></semantics></math>
(one scalar parameter for each unique combination of study and rep)
towards a common normal distribution with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\mu_t</annotation></semantics></math>
and variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>τ</mi><mi>t</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\tau_t^2</annotation></semantics></math>.
For each study in the data (both current and historical), the covariance
is user-defined. Options include:</p>
<ol style="list-style-type: decimal">
<li>Fully parameterized (“unstructured”) with a separation strategy with
the LKJ prior to model within-subject correlations among residuals.</li>
<li>AR(1) variances
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math>
and correlation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ρ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\rho_k</annotation></semantics></math>.</li>
<li>Diagonal with variances
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math>.</li>
</ol>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>y</mi><mi>k</mi></msub><mo>∼</mo><mtext mathvariant="normal">MVN</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>α</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>α</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>δ</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>β</mi><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>I</mi><msub><mi>N</mi><mi>k</mi></msub></msub><mo>⊗</mo><msub><mi>Σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>α</mi><mrow><mi>k</mi><mi>t</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msubsup><mi>τ</mi><mi>t</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>μ</mi><mi>t</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>μ</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>τ</mi><mi>t</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><msub><mi>f</mi><mi>τ</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>δ</mi><mrow><mi>d</mi><mi>t</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>δ</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>β</mi><mi>b</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>β</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>Σ</mi><mi>k</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>I</mi><mi>T</mi></msub><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Λ</mi><mi>k</mi></msub><msub><mi>Λ</mi><mi>k</mi></msub><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>I</mi><mi>T</mi></msub><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>σ</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>σ</mi><mrow><mi>k</mi><mi>T</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>s</mi><mi>σ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>Λ</mi><mi>k</mi></msub><msub><mi>Λ</mi><mi>k</mi></msub><mi>′</mi><mo>∼</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">LKJ</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">shape</mtext><mo>=</mo><msub><mi>s</mi><mi>λ</mi></msub><mo>,</mo><mspace width="0.222em"></mspace><mtext mathvariant="normal">order</mtext><mo>=</mo><mi>T</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">AR(1)</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>,</mo><msub><mi>ρ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>2</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>I</mi><mi>T</mi></msub></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>3</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr></mtable></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>ρ</mi><mi>k</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">only for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
&amp; y_k \sim \text{MVN}((X_\alpha)_k \cdot \alpha + (X_\delta)_k \cdot \delta + (X_\beta)_k \cdot \beta, \ I_{N_k} \otimes \Sigma_k ) \\
&amp; \qquad \alpha_{kt} \stackrel{\text{ind}}{\sim} \text{Normal} (\mu_t, \tau_t^2) \\
&amp; \qquad \qquad \mu_t \stackrel{\text{ind}}{\sim} \text{Normal}(0, s_\mu^2) \\
&amp; \qquad \qquad \tau_t \stackrel{\text{ind}}{\sim} f_\tau \\
&amp; \qquad \delta_{dt} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\delta^2) \\
&amp; \qquad \beta_{b} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \Sigma_k = \left (I_T \sigma_k \right ) \Lambda_k \Lambda_k' \left (I_T \sigma_k \right ) \\
&amp; \qquad \qquad \sigma_{k1}, \ldots, \sigma_{kT} \stackrel{\text{ind}}{\sim} \text{Uniform}(0, s_\sigma) \\
&amp; \qquad \qquad \Lambda_k \Lambda_k' \sim \begin{cases}
  \text{LKJ}(\text{shape} = s_\lambda, \ \text{order} = T) &amp;&amp; m_k = 1 \\
  \text{AR(1)}(T,\rho_k) &amp;&amp; m_k = 2 \\
  I_T &amp;&amp; m_k = 3 \\
\end{cases} \\
&amp; \qquad \qquad \rho_k \stackrel{\text{ind}}{\sim} \text{Uniform}(-1, 1) \qquad (\text{only for } m_k = 2)
\end{aligned} 
</annotation></semantics></math></p>
<p>The prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">f_\tau</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
is critically important because:</p>
<ol style="list-style-type: decimal">
<li>It controls the prior amount of borrowing, and</li>
<li>The prior has a large influence if there are few historical studies
in the data.</li>
</ol>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">f_\tau</annotation></semantics></math>
can either be a flexible half-Student-t distribution with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">d_\tau</annotation></semantics></math>
degrees of freedom and scale parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">s_\tau</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>τ</mi></msub><mo>=</mo><mtext mathvariant="normal">Student-t</mtext><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>s</mi><mi>τ</mi></msub><mo>,</mo><msub><mi>d</mi><mi>τ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">
f_\tau = \text{Student-t}(0, s_\tau, d_\tau)^+
</annotation></semantics></math> or a uniform distribution with lower
bound 0 and upper bound
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">s_\tau</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>τ</mi></msub><mo>=</mo><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>s</mi><mi>τ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
f_\tau = \text{Uniform}(0, s_\tau)
</annotation></semantics></math></p>
<p>Following the recommendation of <span class="citation">Gelman
(2006)</span>, please use half-Student-t if the number of historical
studies is small and consider uniform for large numbers of historical
studies.</p>
<p>For the half-Student-t distribution, the role of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">s_\tau</annotation></semantics></math>
parameter is equivalent to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
parameter from the <a href="https://mc-stan.org/docs/functions-reference/unbounded_continuous_distributions.html#student-t-distribution" class="external-link">Student-t
parameterization in the Stan user manual</a>.</p>
</div>
<div class="section level3">
<h3 id="independent-model">Independent model<a class="anchor" aria-label="anchor" href="#independent-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hbl_sim_independent.html">hbl_sim_independent()</a></code></li>
<li><code><a href="../reference/hbl_mcmc_independent.html">hbl_mcmc_independent()</a></code></li>
</ul>
<p>The independent model is the same as the hierarchical model, but with
independent control group parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
We use it as a no-borrowing benchmark to quantify the borrowing strength
of the hierarchical model.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>y</mi><mi>k</mi></msub><mo>∼</mo><mtext mathvariant="normal">MVN</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>α</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>α</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>δ</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>β</mi><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>I</mi><msub><mi>N</mi><mi>k</mi></msub></msub><mo>⊗</mo><msub><mi>Σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>α</mi><mrow><mi>k</mi><mi>t</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>α</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>δ</mi><mrow><mi>d</mi><mi>t</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>δ</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>β</mi><mi>b</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>β</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>Σ</mi><mi>k</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>I</mi><mi>T</mi></msub><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Λ</mi><mi>k</mi></msub><msub><mi>Λ</mi><mi>k</mi></msub><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>I</mi><mi>T</mi></msub><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>σ</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>σ</mi><mrow><mi>k</mi><mi>T</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>s</mi><mi>σ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>Λ</mi><mi>k</mi></msub><msub><mi>Λ</mi><mi>k</mi></msub><mi>′</mi><mo>∼</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">LKJ</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">shape</mtext><mo>=</mo><msub><mi>s</mi><mi>λ</mi></msub><mo>,</mo><mspace width="0.222em"></mspace><mtext mathvariant="normal">order</mtext><mo>=</mo><mi>T</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">AR(1)</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>,</mo><msub><mi>ρ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>2</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>I</mi><mi>T</mi></msub></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>3</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr></mtable></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>ρ</mi><mi>k</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">only for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
&amp; y_k \sim \text{MVN}((X_\alpha)_k \cdot \alpha + (X_\delta)_k \cdot \delta + (X_\beta)_k \cdot \beta, \ I_{N_k} \otimes \Sigma_k ) \\
&amp; \qquad \alpha_{kt} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\alpha^2) \\
&amp; \qquad \delta_{dt} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\delta^2) \\
&amp; \qquad \beta_{b} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \Sigma_k = \left (I_T \sigma_k \right ) \Lambda_k \Lambda_k' \left (I_T \sigma_k \right ) \\
&amp; \qquad \qquad \sigma_{k1}, \ldots, \sigma_{kT} \stackrel{\text{ind}}{\sim} \text{Uniform}(0, s_\sigma) \\
&amp; \qquad \qquad \Lambda_k \Lambda_k' \sim \begin{cases}
  \text{LKJ}(\text{shape} = s_\lambda, \ \text{order} = T) &amp;&amp; m_k = 1 \\
  \text{AR(1)}(T,\rho_k) &amp;&amp; m_k = 2 \\
  I_T &amp;&amp; m_k = 3 \\
\end{cases} \\
&amp; \qquad \qquad \rho_k \stackrel{\text{ind}}{\sim} \text{Uniform}(-1, 1) \qquad (\text{only for } m_k = 2)
\end{aligned} 
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="pooled-model">Pooled model<a class="anchor" aria-label="anchor" href="#pooled-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hbl_sim_pool.html">hbl_sim_pool()</a></code></li>
<li><code><a href="../reference/hbl_mcmc_pool.html">hbl_mcmc_pool()</a></code></li>
</ul>
<p>The pooled model is the same as the independent model, but with
rep-specific control means pooled across studies. In other words
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mrow><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\alpha_{kt}</annotation></semantics></math>
loses the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
subscript, and we use a smaller matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>X</mi><mi>α</mi><mtext mathvariant="normal">pool</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\alpha^{\text{pool}} \right )_k</annotation></semantics></math>
instead of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>α</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">(X_\alpha)_k</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>X</mi><mi>α</mi><mtext mathvariant="normal">pool</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><annotation encoding="application/x-tex">\left (X_\alpha^{\text{pool}} \right )_k</annotation></semantics></math>
has fewer columns (rep-specific rather than study-by-rep-specific). Like
the independent model, we use it as a no-borrowing benchmark to quantify
the borrowing strength of the hierarchical model.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>y</mi><mi>k</mi></msub><mo>∼</mo><mtext mathvariant="normal">MVN</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>X</mi><mi>α</mi><mtext mathvariant="normal">pool</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>α</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>δ</mi><mo>+</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>β</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msub><mo>⋅</mo><mi>β</mi><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>I</mi><msub><mi>N</mi><mi>k</mi></msub></msub><mo>⊗</mo><msub><mi>Σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>α</mi><mi>t</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>α</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>δ</mi><mrow><mi>d</mi><mi>t</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>δ</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>β</mi><mi>b</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>s</mi><mi>β</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><msub><mi>Σ</mi><mi>k</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>I</mi><mi>T</mi></msub><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Λ</mi><mi>k</mi></msub><msub><mi>Λ</mi><mi>k</mi></msub><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>I</mi><mi>T</mi></msub><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>σ</mi><mrow><mi>k</mi><mn>1</mn></mrow></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>σ</mi><mrow><mi>k</mi><mi>T</mi></mrow></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>s</mi><mi>σ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>Λ</mi><mi>k</mi></msub><msub><mi>Λ</mi><mi>k</mi></msub><mi>′</mi><mo>∼</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">LKJ</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">shape</mtext><mo>=</mo><msub><mi>s</mi><mi>λ</mi></msub><mo>,</mo><mspace width="0.222em"></mspace><mtext mathvariant="normal">order</mtext><mo>=</mo><mi>T</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">AR(1)</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>,</mo><msub><mi>ρ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>2</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>I</mi><mi>T</mi></msub></mtd><mtd columnalign="left" style="text-align: left"></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>3</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr></mtable></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><msub><mi>ρ</mi><mi>k</mi></msub><mover><mo>∼</mo><mtext mathvariant="normal">ind</mtext></mover><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">only for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
&amp; y_k \sim \text{MVN}((X_\alpha^{\text{pool}})_k \cdot \alpha + (X_\delta)_k \cdot \delta + (X_\beta)_k \cdot \beta, \ I_{N_k} \otimes \Sigma_k ) \\
&amp; \qquad \alpha_{t} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\alpha^2) \\
&amp; \qquad \delta_{dt} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\delta^2) \\
&amp; \qquad \beta_{b} \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \Sigma_k = \left (I_T \sigma_k \right ) \Lambda_k \Lambda_k' \left (I_T \sigma_k \right ) \\
&amp; \qquad \qquad \sigma_{k1}, \ldots, \sigma_{kT} \stackrel{\text{ind}}{\sim} \text{Uniform}(0, s_\sigma) \\
&amp; \qquad \qquad \Lambda_k \Lambda_k' \sim \begin{cases}
  \text{LKJ}(\text{shape} = s_\lambda, \ \text{order} = T) &amp;&amp; m_k = 1 \\
  \text{AR(1)}(T,\rho_k) &amp;&amp; m_k = 2 \\
  I_T &amp;&amp; m_k = 3 \\
\end{cases} \\
&amp; \qquad \qquad \rho_k \stackrel{\text{ind}}{\sim} \text{Uniform}(-1, 1) \qquad (\text{only for } m_k = 2)
\end{aligned} 
</annotation></semantics></math></p>
</div>
</div>
<div class="section level2">
<h2 id="borrowing-metrics">Borrowing metrics<a class="anchor" aria-label="anchor" href="#borrowing-metrics"></a>
</h2>
<p>The package supports the following metrics to quantify borrowing.
Various functions in <code>historicalborrowlong</code> compute each of
the following metrics independently for each discrete time point
(“rep”).</p>
<div class="section level3">
<h3 id="effective-sample-size-ess">Effective sample size (ESS)<a class="anchor" aria-label="anchor" href="#effective-sample-size-ess"></a>
</h3>
<p>See the <code><a href="../reference/hbl_ess.html">hbl_ess()</a></code> function for an implementation.</p>
<p><span class="citation">Neuenschwander et al. (2006)</span> posit a
prior effective sample size metric for meta-analytic predictive (MAP)
priors. In the original paper, the underlying hierarchical model only
uses historical controls, and the hypothetical new study is the current
study of interest. In <code>historicalborrow</code>, we adapt this
metric to a hierarchical model which also includes both control and
treatment data from the current study. We still define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
below to be the number of (non-missing) historical control patients so
we can still interpret ESS on the same scale as in the paper.</p>
<p>For the pooled model, define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mn>0</mn></msub><annotation encoding="application/x-tex">V_0</annotation></semantics></math>
to be the posterior predictive variance of the control mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mo>*</mo></msup><annotation encoding="application/x-tex">\alpha^*</annotation></semantics></math>
of a hypothetical new unobserved study. According to <span class="citation">Neuenschwander et al. (2006)</span>, it can be derived
as an average of study-specific variances. In practice, we estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mn>0</mn></msub><annotation encoding="application/x-tex">V_0</annotation></semantics></math>
using the average of MCMC samples of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mrow><mo>∑</mo><msubsup><mi>σ</mi><mi>i</mi><mrow><mo>−</mo><mn>2</mn></mrow></msubsup></mrow></mfrac><annotation encoding="application/x-tex">\frac{1}{\sum \sigma_i^{-2}}</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mn>0</mn></msub><mo>:=</mo><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo>,</mo><mi>τ</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mo>∑</mo><msubsup><mi>σ</mi><mi>i</mi><mrow><mo>−</mo><mn>2</mn></mrow></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">
V_0 := \text{Var}(\alpha^* | y, \tau = 0) = \frac{1}{\sum \sigma_i^{-2}}
</annotation></semantics></math></p>
<p>For the hierarchical model, we define the analogous posterior
predictive variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">V_\tau</annotation></semantics></math>
using the prior distribution</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>τ</mi></msub><mo>:=</mo><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>∫</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><mo stretchy="false" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo>−</mo><mi>E</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mrow><mo stretchy="true" form="prefix">|</mo><mi>y</mi><mo stretchy="false" form="postfix">)</mo><msup><mo stretchy="false" form="postfix">)</mo><mn>2</mn></msup><mo stretchy="true" form="postfix">|</mo></mrow><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>⋅</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo stretchy="false" form="prefix">|</mo><mi>μ</mi><mo>,</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>,</mo><mi>τ</mi><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>μ</mi><mi>d</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">
V_\tau := \text{Var}(\alpha^* | y) = \int E[(\alpha^* - E(\alpha^*|y))^2 | y] \cdot p(\alpha^* | \mu, \tau) \cdot p(\mu, \tau | y) d\mu d\tau
</annotation></semantics></math></p>
<p>The above integral implies a straightforward method of estimating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">V_\tau</annotation></semantics></math>
using MCMC samples:</p>
<ol style="list-style-type: decimal">
<li>For each MCMC sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">m = 1, \ldots, M</annotation></semantics></math>
from the hierarchical model, identify samples
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>μ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\mu^{(m)}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\tau^{(m)}</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
respectively.</li>
<li>Draw
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>m</mi></msup><annotation encoding="application/x-tex">(\alpha^*)^{m}</annotation></semantics></math>
from a
Normal(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>μ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\mu^{(m)}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>τ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><annotation encoding="application/x-tex">(\tau^{(m)})^2</annotation></semantics></math>)
distribution.</li>
<li>Estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">V_\tau</annotation></semantics></math>
as the variance of the collection
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mn>1</mn></msup><mo>,</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>,</mo><mi>…</mi><mo>,</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>M</mi></msup></mrow><annotation encoding="application/x-tex">(\alpha^*)^{1}, (\alpha^*)^{2}, \ldots, (\alpha^*)^{M}</annotation></semantics></math>
from (2).</li>
</ol>
<p>Next, define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
as the number of non-missing control patients from the historical
studies only. Given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mn>0</mn></msub><annotation encoding="application/x-tex">V_0</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>τ</mi></msub><annotation encoding="application/x-tex">V_\tau</annotation></semantics></math>,
define the effective sample size as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ESS</mtext><mo>:=</mo><mi>N</mi><mfrac><msub><mi>V</mi><mn>0</mn></msub><msub><mi>V</mi><mi>τ</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">
\text{ESS} := N \frac{V_0}{V_\tau}
</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><msub><mi>V</mi><mn>0</mn></msub><msub><mi>V</mi><mi>τ</mi></msub></mfrac><annotation encoding="application/x-tex">\frac{V_0}{V_\tau}</annotation></semantics></math>
is a weight which quantifies the fraction of historical information that
the hierarchical model leverages for borrowing. Notably, the weight
should be 1 if the hierarchical and pooled model exhibit the same
strength of borrowing. Multiplied by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>,
the quantity becomes a heuristic for the strength of borrowing of the
hierarchical model, measured in terms of the number of historical
patients.</p>
</div>
<div class="section level3">
<h3 id="precision-ratio-hierarchical-model-only">Precision ratio (hierarchical model only)<a class="anchor" aria-label="anchor" href="#precision-ratio-hierarchical-model-only"></a>
</h3>
<p>The precision ratio is an experimental ad hoc metric and should be
used with caution. It is implemented in the <code><a href="../reference/hbl_summary.html">hbl_summary()</a></code>
function for the hierarchical model.</p>
<p>The precision ratio compares the prior precision of a control mean
response (an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
component, numerator) to the analogous precision of the full conditional
distribution (denominator). The former is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><msup><mi>τ</mi><mn>2</mn></msup></mfrac><annotation encoding="application/x-tex">\frac{1}{\tau^2}</annotation></semantics></math>,
and the latter is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><msup><mi>τ</mi><mn>2</mn></msup></mfrac><mo>+</mo><mfrac><mi>n</mi><msup><mi>σ</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{\tau^2} + \frac{n}{\sigma^2}</annotation></semantics></math>.
Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is the number of non-missing patients in the current study,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>
is the residual variance, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\tau^2</annotation></semantics></math>
is the variance of study-specific control means (components of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>).
The full precision ratio is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mfrac><mfrac><mn>1</mn><msup><mi>τ</mi><mn>2</mn></msup></mfrac><mrow><mfrac><mn>1</mn><msup><mi>τ</mi><mn>2</mn></msup></mfrac><mo>+</mo><mfrac><mi>n</mi><msup><mi>σ</mi><mn>2</mn></msup></mfrac></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\frac{\frac{1}{\tau^2}}{\frac{1}{\tau^2} + \frac{n}{\sigma^2}}
\end{aligned}
</annotation></semantics></math></p>
<p>The precision ratio comes from the conditional distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\alpha_k</annotation></semantics></math>
in the hierarchical model given the other parameters and the data. More
precisely, in this conditional distribution, the mean is a weighted
average between the prior mean and data mean, and the precision ratio is
the weight on the prior mean. This can be seen in a simpler case with a
Bayesian model with a normal data model, a normal prior on the mean, and
known constant variance. For details, see Chapter 2 of <span class="citation">Gelman et al. (2020)</span>.</p>
</div>
<div class="section level3">
<h3 id="variance-shift-ratio">Variance shift ratio<a class="anchor" aria-label="anchor" href="#variance-shift-ratio"></a>
</h3>
<p>The variance shift ratio is an experimental ad hoc metric and should
be used with caution. It is implemented in the legacy
<code><a href="../reference/hbl_metrics.html">hbl_metrics()</a></code> function.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>m</mi></msub><annotation encoding="application/x-tex">V_m</annotation></semantics></math>
be the estimated posterior variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>I</mi></msub><annotation encoding="application/x-tex">\alpha_I</annotation></semantics></math>
(current study control group response mean) estimated by model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>.
The variance shift ratio is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mfrac><mrow><msub><mi>V</mi><mrow><mi>m</mi><mo>*</mo></mrow></msub><mo>−</mo><msub><mi>V</mi><mtext mathvariant="normal">independent</mtext></msub></mrow><mrow><msub><mi>V</mi><mtext mathvariant="normal">pool</mtext></msub><mo>−</mo><msub><mi>V</mi><mtext mathvariant="normal">independent</mtext></msub></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\frac{V_{m*} - V_{\text{independent}}}{V_{\text{pool}} - V_{\text{independent}}}
\end{aligned}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>*</mo></mrow><annotation encoding="application/x-tex">m*</annotation></semantics></math>
is a historical borrowing model like the mixture model or hierarchical
model.</p>
</div>
<div class="section level3">
<h3 id="mean-shift-ratio-legacy">Mean shift ratio (legacy)<a class="anchor" aria-label="anchor" href="#mean-shift-ratio-legacy"></a>
</h3>
<p>The mean shift ratio is not recommended to measure the strength of
borrowing. Rather, it is an informal ad hoc measure of the lack of
commensurability between the current and historical data sources. It is
implemented in the legacy <code><a href="../reference/hbl_metrics.html">hbl_metrics()</a></code> function.</p>
<p>To define the mean shift ratio, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>m</mi></msub><annotation encoding="application/x-tex">\theta_m</annotation></semantics></math>
be the posterior mean control group response estimated by model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>.
The mean shift ratio is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mfrac><mrow><msub><mi>θ</mi><mrow><mi>m</mi><mo>*</mo></mrow></msub><mo>−</mo><msub><mi>θ</mi><mtext mathvariant="normal">independent</mtext></msub></mrow><mrow><msub><mi>θ</mi><mtext mathvariant="normal">pool</mtext></msub><mo>−</mo><msub><mi>θ</mi><mtext mathvariant="normal">independent</mtext></msub></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\frac{\theta_{m*} - \theta_{\text{independent}}}{\theta_{\text{pool}} - \theta_{\text{independent}}}
\end{aligned}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>*</mo></mrow><annotation encoding="application/x-tex">m*</annotation></semantics></math>
is a historical borrowing model like the mixture model or hierarchical
model.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-gelman2006" class="csl-entry">
Gelman, A. 2006. <span>“Prior Distributions for Variance Parameters in
Hierarchical Models.”</span> <em><span>B</span>ayesian
<span>A</span>nalysis</em> 1 (3): 515–43. <a href="https://doi.org/10.1214/06-BA117A" class="external-link">https://doi.org/10.1214/06-BA117A</a>.
</div>
<div id="ref-bda3" class="csl-entry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D.
B. Rubin. 2020. <em><span>B</span>ayesian <span>D</span>ata
<span>A</span>nalysis</em>. 3rd ed. <span>CRC</span> <span>P</span>ress.
</div>
<div id="ref-lenth2016" class="csl-entry">
Lenth, Russell V. 2016. <span>“Least-Squares Means: The r Package
Lsmeans.”</span> <em>Journal of Statistical Software</em> 69 (1): 1–33.
<a href="https://doi.org/10.18637/jss.v069.i01" class="external-link">https://doi.org/10.18637/jss.v069.i01</a>.
</div>
<div id="ref-neuenschwander2010" class="csl-entry">
Neuenschwander, B., G. Capkun-Niggli, M. Branson, and D. J.
Spiegelhalter. 2006. <span>“Summarizing Historical Information on
Controls in Clinical Trials.”</span> <em><span>B</span>ayesian
<span>A</span>nalysis</em> 1 (3): 515–43. <a href="https://doi.org/10.1214/06-BA117A" class="external-link">https://doi.org/10.1214/06-BA117A</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
